<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RM Transcription Manager - Prototype</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        .audio-player {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .waveform {
            height: 60px;
            display: flex;
            align-items: center;
            gap: 2px;
        }
        .waveform-bar {
            width: 3px;
            background: rgba(255,255,255,0.6);
            border-radius: 2px;
            transition: all 0.3s ease;
        }
        .waveform-bar.active {
            background: white;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50">

    <!-- Header -->
    <header class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <i class="fas fa-microphone-alt text-blue-600 text-2xl mr-3"></i>
                    <h1 class="text-2xl font-bold text-gray-900">Transcription Manager</h1>
                </div>
                <div class="flex items-center gap-4">
                    <span class="text-sm text-gray-600">RM: Sarah Johnson</span>
                    <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-semibold">
                        SJ
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-medium text-gray-600">Total Recordings</span>
                    <i class="fas fa-file-audio text-blue-500"></i>
                </div>
                <div class="text-3xl font-bold text-gray-900">127</div>
                <div class="text-sm text-green-600 mt-2">
                    <i class="fas fa-arrow-up"></i> 12 this week
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-medium text-gray-600">Pending Review</span>
                    <i class="fas fa-clock text-orange-500"></i>
                </div>
                <div class="text-3xl font-bold text-gray-900">8</div>
                <div class="text-sm text-gray-500 mt-2">Requires action</div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-medium text-gray-600">Linked to CRM</span>
                    <i class="fas fa-link text-green-500"></i>
                </div>
                <div class="text-3xl font-bold text-gray-900">98</div>
                <div class="text-sm text-gray-500 mt-2">77% linked</div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-medium text-gray-600">Avg Duration</span>
                    <i class="fas fa-stopwatch text-purple-500"></i>
                </div>
                <div class="text-3xl font-bold text-gray-900">18m</div>
                <div class="text-sm text-gray-500 mt-2">Per meeting</div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex gap-4 mb-8">
            <button onclick="openUploadModal()" class="bg-blue-600 hover:bg-blue-700 text-white font-medium px-6 py-3 rounded-lg transition flex items-center gap-2">
                <i class="fas fa-upload"></i>
                Upload Recording
            </button>
            <button onclick="startRecording()" class="bg-green-600 hover:bg-green-700 text-white font-medium px-6 py-3 rounded-lg transition flex items-center gap-2">
                <i class="fas fa-microphone"></i>
                Start Recording
            </button>
        </div>

        <!-- Filters and Search -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="md:col-span-2">
                    <input type="text" id="searchInput" placeholder="Search transcriptions..." 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           oninput="filterTranscriptions()">
                </div>
                <select id="statusFilter" onchange="filterTranscriptions()" 
                        class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    <option value="">All Status</option>
                    <option value="completed">Completed</option>
                    <option value="processing">Processing</option>
                    <option value="pending">Pending Review</option>
                </select>
                <select id="crmFilter" onchange="filterTranscriptions()" 
                        class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    <option value="">All Records</option>
                    <option value="linked">Linked to CRM</option>
                    <option value="unlinked">Not Linked</option>
                </select>
            </div>
        </div>

        <!-- Transcriptions List -->
        <div id="transcriptionsList" class="space-y-4">
            <!-- Populated by JavaScript -->
        </div>
    </main>

    <!-- Upload Modal -->
    <div id="uploadModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-2xl font-semibold">Upload Recording</h3>
                    <button onclick="closeUploadModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Recording File</label>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-500 transition cursor-pointer"
                         onclick="document.getElementById('fileInput').click()">
                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-3"></i>
                        <p class="text-gray-600">Click to upload or drag and drop</p>
                        <p class="text-sm text-gray-500 mt-2">MP3, WAV, M4A (max 100MB)</p>
                        <input type="file" id="fileInput" class="hidden" accept="audio/*" onchange="handleFileSelect(event)">
                    </div>
                    <div id="selectedFile" class="hidden mt-4 p-4 bg-blue-50 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <i class="fas fa-file-audio text-blue-600 text-2xl"></i>
                                <div>
                                    <p class="font-medium text-gray-900" id="fileName"></p>
                                    <p class="text-sm text-gray-600" id="fileSize"></p>
                                </div>
                            </div>
                            <button onclick="clearFile()" class="text-red-600 hover:text-red-700">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Meeting Title</label>
                    <input type="text" id="meetingTitle" placeholder="e.g., Client Review - Q4 Portfolio"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Link to CRM Record (Optional)</label>
                    <select id="crmRecord" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        <option value="">Select CRM Record...</option>
                        <option value="1">John Smith - Portfolio Review</option>
                        <option value="2">Acme Corp - Investment Strategy</option>
                        <option value="3">Jane Doe - Retirement Planning</option>
                        <option value="4">Tech Ventures LLC - Risk Assessment</option>
                    </select>
                </div>

                <div class="flex justify-end gap-3">
                    <button onclick="closeUploadModal()" class="px-6 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition">
                        Cancel
                    </button>
                    <button onclick="uploadRecording()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                        Upload & Process
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Transcription Detail Modal -->
    <div id="detailModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto">
        <div class="bg-white rounded-lg shadow-xl max-w-5xl w-full mx-4 my-8">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-2xl font-semibold" id="detailTitle"></h3>
                    <button onclick="closeDetailModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <!-- Audio Player -->
                <div class="audio-player rounded-lg p-6 mb-6 text-white">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-4">
                            <button onclick="togglePlay()" class="w-12 h-12 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full flex items-center justify-center transition">
                                <i class="fas fa-play" id="playIcon"></i>
                            </button>
                            <div>
                                <p class="font-semibold" id="audioTitle">Client Meeting Recording</p>
                                <p class="text-sm opacity-90" id="audioDate">November 15, 2024</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-2xl font-bold" id="currentTime">00:00</p>
                            <p class="text-sm opacity-90" id="totalTime">18:45</p>
                        </div>
                    </div>
                    
                    <!-- Waveform Visualization -->
                    <div class="waveform mb-4" id="waveform">
                        <!-- Generated by JavaScript -->
                    </div>
                    
                    <!-- Progress Bar -->
                    <input type="range" min="0" max="100" value="0" id="progressBar" 
                           class="w-full h-2 bg-white bg-opacity-20 rounded-lg appearance-none cursor-pointer"
                           oninput="seekAudio(this.value)">
                    
                    <div class="flex items-center justify-between mt-4">
                        <div class="flex items-center gap-3">
                            <button class="hover:text-white opacity-75 hover:opacity-100 transition">
                                <i class="fas fa-backward"></i>
                            </button>
                            <button class="hover:text-white opacity-75 hover:opacity-100 transition">
                                <i class="fas fa-forward"></i>
                            </button>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="text-sm">Speed:</span>
                            <select class="bg-white bg-opacity-20 rounded px-2 py-1 text-sm">
                                <option>0.5x</option>
                                <option>0.75x</option>
                                <option selected>1x</option>
                                <option>1.25x</option>
                                <option>1.5x</option>
                                <option>2x</option>
                            </select>
                            <button class="hover:text-white opacity-75 hover:opacity-100 transition">
                                <i class="fas fa-volume-up"></i>
                            </button>
                            <button onclick="downloadAudio()" class="hover:text-white opacity-75 hover:opacity-100 transition">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="border-b border-gray-200 mb-6">
                    <nav class="flex gap-8">
                        <button onclick="switchTab('summary')" class="tab-btn py-3 border-b-2 border-blue-600 text-blue-600 font-medium">
                            Summary
                        </button>
                        <button onclick="switchTab('transcription')" class="tab-btn py-3 border-b-2 border-transparent text-gray-600 hover:text-gray-900">
                            Full Transcription
                        </button>
                        <button onclick="switchTab('insights')" class="tab-btn py-3 border-b-2 border-transparent text-gray-600 hover:text-gray-900">
                            Key Insights
                        </button>
                    </nav>
                </div>

                <!-- Tab Content -->
                <div id="summaryTab" class="tab-content">
                    <div class="bg-blue-50 border-l-4 border-blue-600 p-6 mb-6 rounded">
                        <h4 class="font-semibold text-lg mb-3 text-gray-900">Meeting Summary</h4>
                        <p class="text-gray-700 leading-relaxed" id="summaryText">
                            <!-- Populated by JavaScript -->
                        </p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="bg-white border border-gray-200 rounded-lg p-4">
                            <h5 class="font-semibold mb-3 flex items-center gap-2">
                                <i class="fas fa-check-circle text-green-600"></i>
                                Action Items
                            </h5>
                            <ul class="space-y-2" id="actionItems">
                                <!-- Populated by JavaScript -->
                            </ul>
                        </div>

                        <div class="bg-white border border-gray-200 rounded-lg p-4">
                            <h5 class="font-semibold mb-3 flex items-center gap-2">
                                <i class="fas fa-users text-blue-600"></i>
                                Participants
                            </h5>
                            <ul class="space-y-2" id="participants">
                                <!-- Populated by JavaScript -->
                            </ul>
                        </div>
                    </div>

                    <!-- CRM Link Section -->
                    <div class="bg-gray-50 rounded-lg p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h5 class="font-semibold flex items-center gap-2">
                                <i class="fas fa-link text-gray-600"></i>
                                CRM Integration
                            </h5>
                            <button onclick="linkToCRM()" class="text-blue-600 hover:text-blue-700 text-sm font-medium">
                                <i class="fas fa-edit"></i> Change Link
                            </button>
                        </div>
                        <div id="crmLinkInfo" class="flex items-center gap-4 p-4 bg-white rounded-lg border border-gray-200">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <div id="transcriptionTab" class="tab-content hidden">
                    <div class="bg-white border border-gray-200 rounded-lg p-6 max-h-96 overflow-y-auto">
                        <div id="transcriptionText" class="space-y-4">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <div id="insightsTab" class="tab-content hidden">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white border border-gray-200 rounded-lg p-6">
                            <h5 class="font-semibold mb-4 flex items-center gap-2">
                                <i class="fas fa-chart-line text-green-600"></i>
                                Sentiment Analysis
                            </h5>
                            <div class="space-y-3">
                                <div>
                                    <div class="flex justify-between mb-1">
                                        <span class="text-sm text-gray-600">Positive</span>
                                        <span class="text-sm font-medium">65%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-green-500 h-2 rounded-full" style="width: 65%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between mb-1">
                                        <span class="text-sm text-gray-600">Neutral</span>
                                        <span class="text-sm font-medium">25%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-gray-400 h-2 rounded-full" style="width: 25%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between mb-1">
                                        <span class="text-sm text-gray-600">Negative</span>
                                        <span class="text-sm font-medium">10%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-red-500 h-2 rounded-full" style="width: 10%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white border border-gray-200 rounded-lg p-6">
                            <h5 class="font-semibold mb-4 flex items-center gap-2">
                                <i class="fas fa-tags text-purple-600"></i>
                                Key Topics
                            </h5>
                            <div class="flex flex-wrap gap-2">
                                <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm">Portfolio Review</span>
                                <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm">Risk Assessment</span>
                                <span class="px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm">Investment Strategy</span>
                                <span class="px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-sm">Market Outlook</span>
                                <span class="px-3 py-1 bg-pink-100 text-pink-700 rounded-full text-sm">Retirement Planning</span>
                            </div>
                        </div>

                        <div class="bg-white border border-gray-200 rounded-lg p-6 md:col-span-2">
                            <h5 class="font-semibold mb-4 flex items-center gap-2">
                                <i class="fas fa-lightbulb text-yellow-600"></i>
                                AI Recommendations
                            </h5>
                            <ul class="space-y-3">
                                <li class="flex items-start gap-3">
                                    <i class="fas fa-arrow-right text-blue-600 mt-1"></i>
                                    <span class="text-gray-700">Schedule follow-up meeting in 2 weeks to review portfolio adjustments</span>
                                </li>
                                <li class="flex items-start gap-3">
                                    <i class="fas fa-arrow-right text-blue-600 mt-1"></i>
                                    <span class="text-gray-700">Send client the updated risk assessment document discussed</span>
                                </li>
                                <li class="flex items-start gap-3">
                                    <i class="fas fa-arrow-right text-blue-600 mt-1"></i>
                                    <span class="text-gray-700">Update CRM with client's new investment preferences</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="flex justify-end gap-3 mt-6 pt-6 border-t">
                    <button onclick="exportTranscription()" class="px-6 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition flex items-center gap-2">
                        <i class="fas fa-file-export"></i>
                        Export
                    </button>
                    <button onclick="closeDetailModal()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mock Data
        const mockTranscriptions = [
            {
                id: 1,
                title: "Portfolio Review - John Smith",
                date: "2024-11-15",
                duration: "18:45",
                status: "completed",
                crmLinked: true,
                crmRecord: "John Smith - Portfolio Review",
                summary: "Comprehensive portfolio review meeting with John Smith. Discussed current market conditions, reviewed Q4 performance showing 8.5% growth, and adjusted asset allocation to reduce risk exposure. Client expressed satisfaction with returns but concerns about market volatility. Agreed to rebalance portfolio with 60/40 equity-bond split.",
                actionItems: [
                    "Rebalance portfolio to 60/40 equity-bond allocation",
                    "Send updated risk assessment document by Nov 20",
                    "Schedule Q1 2025 review meeting",
                    "Research ESG investment options per client request"
                ],
                participants: ["Sarah Johnson (RM)", "John Smith (Client)", "Michael Chen (Advisor)"],
                transcription: [
                    { speaker: "Sarah Johnson", time: "00:00", text: "Good morning John, thank you for joining us today. I have Michael Chen, our senior advisor, joining us as well." },
                    { speaker: "John Smith", time: "00:15", text: "Good morning Sarah, Michael. Thanks for arranging this review." },
                    { speaker: "Sarah Johnson", time: "00:25", text: "Let's start by reviewing your portfolio performance for Q4. Overall, we're seeing an 8.5% growth which is above our projected target." },
                    { speaker: "John Smith", time: "00:45", text: "That's great to hear. I've been a bit concerned about the market volatility lately." },
                    { speaker: "Michael Chen", time: "01:00", text: "That's a valid concern. We're recommending a rebalancing to reduce risk exposure while maintaining growth potential." }
                ]
            },
            {
                id: 2,
                title: "Investment Strategy - Acme Corp",
                date: "2024-11-14",
                duration: "25:30",
                status: "completed",
                crmLinked: true,
                crmRecord: "Acme Corp - Investment Strategy",
                summary: "Strategic planning session with Acme Corp CFO regarding corporate investment portfolio. Discussed diversification strategies, reviewed current holdings, and explored opportunities in emerging markets. Client interested in sustainable investment options and ESG compliance.",
                actionItems: [
                    "Prepare ESG investment proposal",
                    "Research emerging market opportunities",
                    "Schedule board presentation for December",
                    "Review corporate bond portfolio"
                ],
                participants: ["Sarah Johnson (RM)", "Robert Williams (CFO)", "Lisa Anderson (Treasurer)"],
                transcription: [
                    { speaker: "Sarah Johnson", time: "00:00", text: "Thank you for meeting with us today. Let's discuss your corporate investment strategy." },
                    { speaker: "Robert Williams", time: "00:12", text: "We're particularly interested in ESG-compliant investments this quarter." }
                ]
            },
            {
                id: 3,
                title: "Retirement Planning - Jane Doe",
                date: "2024-11-13",
                duration: "15:20",
                status: "completed",
                crmLinked: true,
                crmRecord: "Jane Doe - Retirement Planning",
                summary: "Initial retirement planning consultation with Jane Doe, age 52. Discussed retirement goals, current savings, and projected needs. Client plans to retire at 65 with target income of $80,000 annually. Reviewed 401(k) and IRA options.",
                actionItems: [
                    "Calculate retirement savings gap",
                    "Prepare 401(k) contribution increase proposal",
                    "Research Roth IRA conversion options",
                    "Schedule follow-up in 2 weeks"
                ],
                participants: ["Sarah Johnson (RM)", "Jane Doe (Client)"],
                transcription: [
                    { speaker: "Sarah Johnson", time: "00:00", text: "Hi Jane, let's talk about your retirement planning goals." },
                    { speaker: "Jane Doe", time: "00:08", text: "I'm hoping to retire at 65 and need to know if I'm on track." }
                ]
            },
            {
                id: 4,
                title: "Risk Assessment - Tech Ventures LLC",
                date: "2024-11-12",
                duration: "22:15",
                status: "processing",
                crmLinked: true,
                crmRecord: "Tech Ventures LLC - Risk Assessment",
                summary: "Processing...",
                actionItems: [],
                participants: ["Sarah Johnson (RM)", "David Park (CEO)"],
                transcription: []
            },
            {
                id: 5,
                title: "Market Update Call - Multiple Clients",
                date: "2024-11-11",
                duration: "45:00",
                status: "pending",
                crmLinked: false,
                crmRecord: null,
                summary: "Pending review...",
                actionItems: [],
                participants: ["Sarah Johnson (RM)"],
                transcription: []
            }
        ];

        let currentTranscriptions = [...mockTranscriptions];
        let selectedFile = null;
        let isPlaying = false;
        let currentProgress = 0;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderTranscriptions();
            generateWaveform();
        });

        // Render transcriptions list
        function renderTranscriptions() {
            const container = document.getElementById('transcriptionsList');
            container.innerHTML = '';

            currentTranscriptions.forEach(trans => {
                const statusColors = {
                    completed: 'bg-green-100 text-green-700',
                    processing: 'bg-yellow-100 text-yellow-700',
                    pending: 'bg-orange-100 text-orange-700'
                };

                const card = document.createElement('div');
                card.className = 'bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition fade-in cursor-pointer';
                card.onclick = () => openDetailModal(trans.id);
                
                card.innerHTML = `
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">${trans.title}</h3>
                            <div class="flex items-center gap-4 text-sm text-gray-600">
                                <span><i class="fas fa-calendar mr-2"></i>${formatDate(trans.date)}</span>
                                <span><i class="fas fa-clock mr-2"></i>${trans.duration}</span>
                                ${trans.crmLinked ? '<span class="text-green-600"><i class="fas fa-link mr-2"></i>Linked to CRM</span>' : '<span class="text-gray-400"><i class="fas fa-unlink mr-2"></i>Not Linked</span>'}
                            </div>
                        </div>
                        <span class="px-3 py-1 rounded-full text-sm font-medium ${statusColors[trans.status]}">
                            ${trans.status.charAt(0).toUpperCase() + trans.status.slice(1)}
                        </span>
                    </div>
                    
                    ${trans.status === 'completed' ? `
                        <p class="text-gray-700 mb-4 line-clamp-2">${trans.summary}</p>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-users text-gray-400"></i>
                                <span class="text-sm text-gray-600">${trans.participants.length} participants</span>
                            </div>
                            <button onclick="event.stopPropagation(); openDetailModal(${trans.id})" 
                                    class="text-blue-600 hover:text-blue-700 font-medium text-sm flex items-center gap-2">
                                View Details <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    ` : `
                        <div class="flex items-center gap-3 text-gray-600">
                            <i class="fas fa-spinner fa-spin"></i>
                            <span>${trans.status === 'processing' ? 'Transcription in progress...' : 'Awaiting review...'}</span>
                        </div>
                    `}
                `;
                
                container.appendChild(card);
            });
        }

        // Filter transcriptions
        function filterTranscriptions() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const crmFilter = document.getElementById('crmFilter').value;

            currentTranscriptions = mockTranscriptions.filter(trans => {
                const matchesSearch = trans.title.toLowerCase().includes(searchTerm) || 
                                    trans.summary.toLowerCase().includes(searchTerm);
                const matchesStatus = !statusFilter || trans.status === statusFilter;
                const matchesCRM = !crmFilter || 
                                 (crmFilter === 'linked' && trans.crmLinked) ||
                                 (crmFilter === 'unlinked' && !trans.crmLinked);
                
                return matchesSearch && matchesStatus && matchesCRM;
            });

            renderTranscriptions();
        }

        // Upload Modal Functions
        function openUploadModal() {
            document.getElementById('uploadModal').classList.remove('hidden');
        }

        function closeUploadModal() {
            document.getElementById('uploadModal').classList.add('hidden');
            clearFile();
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                selectedFile = file;
                document.getElementById('fileName').textContent = file.name;
                document.getElementById('fileSize').textContent = formatFileSize(file.size);
                document.getElementById('selectedFile').classList.remove('hidden');
            }
        }

        function clearFile() {
            selectedFile = null;
            document.getElementById('fileInput').value = '';
            document.getElementById('selectedFile').classList.add('hidden');
        }

        function uploadRecording() {
            const title = document.getElementById('meetingTitle').value;
            const crmRecord = document.getElementById('crmRecord').value;

            if (!selectedFile) {
                showToast('Please select a file to upload', 'error');
                return;
            }

            if (!title) {
                showToast('Please enter a meeting title', 'error');
                return;
            }

            // Simulate upload
            showToast('Upload started! Processing transcription...', 'success');
            closeUploadModal();

            // Add to list
            setTimeout(() => {
                const newTrans = {
                    id: mockTranscriptions.length + 1,
                    title: title,
                    date: new Date().toISOString().split('T')[0],
                    duration: "00:00",
                    status: "processing",
                    crmLinked: !!crmRecord,
                    crmRecord: crmRecord ? document.querySelector(`#crmRecord option[value="${crmRecord}"]`).text : null,
                    summary: "Processing...",
                    actionItems: [],
                    participants: [],
                    transcription: []
                };
                mockTranscriptions.unshift(newTrans);
                currentTranscriptions = [...mockTranscriptions];
                renderTranscriptions();
            }, 1000);
        }

        // Detail Modal Functions
        function openDetailModal(id) {
            const trans = mockTranscriptions.find(t => t.id === id);
            if (!trans || trans.status !== 'completed') {
                showToast('Transcription not ready yet', 'info');
                return;
            }

            document.getElementById('detailTitle').textContent = trans.title;
            document.getElementById('audioTitle').textContent = trans.title;
            document.getElementById('audioDate').textContent = formatDate(trans.date);
            document.getElementById('totalTime').textContent = trans.duration;
            document.getElementById('summaryText').textContent = trans.summary;

            // Action Items
            const actionItemsList = document.getElementById('actionItems');
            actionItemsList.innerHTML = trans.actionItems.map(item => 
                `<li class="flex items-start gap-2">
                    <i class="fas fa-circle text-xs text-gray-400 mt-1"></i>
                    <span class="text-gray-700">${item}</span>
                </li>`
            ).join('');

            // Participants
            const participantsList = document.getElementById('participants');
            participantsList.innerHTML = trans.participants.map(participant => 
                `<li class="flex items-center gap-2">
                    <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 text-xs font-semibold">
                        ${participant.split(' ').map(n => n[0]).join('')}
                    </div>
                    <span class="text-gray-700">${participant}</span>
                </li>`
            ).join('');

            // CRM Link
            const crmLinkInfo = document.getElementById('crmLinkInfo');
            if (trans.crmLinked) {
                crmLinkInfo.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-check text-green-600"></i>
                        </div>
                        <div>
                            <p class="font-medium text-gray-900">${trans.crmRecord}</p>
                            <p class="text-sm text-gray-600">Linked to CRM</p>
                        </div>
                    </div>
                    <button onclick="viewCRMRecord()" class="text-blue-600 hover:text-blue-700 text-sm font-medium">
                        View in CRM <i class="fas fa-external-link-alt ml-1"></i>
                    </button>
                `;
            } else {
                crmLinkInfo.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-unlink text-gray-400"></i>
                        </div>
                        <div>
                            <p class="font-medium text-gray-900">Not linked to CRM</p>
                            <p class="text-sm text-gray-600">Link this recording to a CRM record</p>
                        </div>
                    </div>
                    <button onclick="linkToCRM()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm">
                        Link to CRM
                    </button>
                `;
            }

            // Transcription
            const transcriptionText = document.getElementById('transcriptionText');
            transcriptionText.innerHTML = trans.transcription.map(entry => 
                `<div class="flex gap-4">
                    <span class="text-sm text-gray-500 font-mono w-16">${entry.time}</span>
                    <div class="flex-1">
                        <p class="font-semibold text-gray-900 mb-1">${entry.speaker}</p>
                        <p class="text-gray-700">${entry.text}</p>
                    </div>
                </div>`
            ).join('');

            document.getElementById('detailModal').classList.remove('hidden');
        }

        function closeDetailModal() {
            document.getElementById('detailModal').classList.add('hidden');
            resetAudioPlayer();
        }

        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('border-blue-600', 'text-blue-600');
                btn.classList.add('border-transparent', 'text-gray-600');
            });

            // Show selected tab
            document.getElementById(tabName + 'Tab').classList.remove('hidden');
            event.target.classList.remove('border-transparent', 'text-gray-600');
            event.target.classList.add('border-blue-600', 'text-blue-600');
        }

        // Audio Player Functions
        function togglePlay() {
            isPlaying = !isPlaying;
            const playIcon = document.getElementById('playIcon');
            
            if (isPlaying) {
                playIcon.className = 'fas fa-pause';
                simulatePlayback();
            } else {
                playIcon.className = 'fas fa-play';
            }
        }

        function simulatePlayback() {
            if (!isPlaying) return;

            currentProgress += 0.5;
            if (currentProgress >= 100) {
                currentProgress = 0;
                isPlaying = false;
                document.getElementById('playIcon').className = 'fas fa-play';
                return;
            }

            document.getElementById('progressBar').value = currentProgress;
            updateWaveform(currentProgress);
            updateTime(currentProgress);

            setTimeout(simulatePlayback, 100);
        }

        function seekAudio(value) {
            currentProgress = parseFloat(value);
            updateWaveform(currentProgress);
            updateTime(currentProgress);
        }

        function updateTime(progress) {
            const totalSeconds = 18 * 60 + 45; // 18:45
            const currentSeconds = Math.floor((progress / 100) * totalSeconds);
            const minutes = Math.floor(currentSeconds / 60);
            const seconds = currentSeconds % 60;
            document.getElementById('currentTime').textContent = 
                `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        function resetAudioPlayer() {
            isPlaying = false;
            currentProgress = 0;
            document.getElementById('playIcon').className = 'fas fa-play';
            document.getElementById('progressBar').value = 0;
            document.getElementById('currentTime').textContent = '00:00';
            updateWaveform(0);
        }

        function generateWaveform() {
            const waveform = document.getElementById('waveform');
            waveform.innerHTML = '';
            
            for (let i = 0; i < 100; i++) {
                const bar = document.createElement('div');
                bar.className = 'waveform-bar';
                const height = Math.random() * 40 + 20;
                bar.style.height = height + 'px';
                waveform.appendChild(bar);
            }
        }

        function updateWaveform(progress) {
            const bars = document.querySelectorAll('.waveform-bar');
            const activeIndex = Math.floor((progress / 100) * bars.length);
            
            bars.forEach((bar, index) => {
                if (index <= activeIndex) {
                    bar.classList.add('active');
                } else {
                    bar.classList.remove('active');
                }
            });
        }

        // Recording Functions
        function startRecording() {
            showToast('Recording started! Click stop when finished.', 'info');
            // In real implementation, would use MediaRecorder API
        }

        // Utility Functions
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }

        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
        }

        function showToast(message, type = 'success') {
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500'
            };

            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg text-white ${colors[type]} z-50 fade-in`;
            toast.innerHTML = `
                <div class="flex items-center gap-3">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function linkToCRM() {
            showToast('CRM linking feature - would open CRM record selector', 'info');
        }

        function viewCRMRecord() {
            showToast('Opening CRM record...', 'info');
        }

        function downloadAudio() {
            showToast('Downloading audio file...', 'success');
        }

        function exportTranscription() {
            showToast('Exporting transcription as PDF...', 'success');
        }
    </script>
</body>
</html>
